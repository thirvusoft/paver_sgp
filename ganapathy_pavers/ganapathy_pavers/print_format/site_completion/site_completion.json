{
 "absolute_value": 0,
 "align_labels_right": 0,
 "creation": "2023-02-14 19:12:42.354736",
 "css": "\n.table, th, td {\n  border: 1px solid black;\n}\n.bg_color {\n    background-color : #e6e6e6;\n}\ntd {\n    font-weight: bold;\n}\n.td {\n  padding: 5px;\n  border: 1px solid black;\n  text-align: left;    \n}\n\n.signature {\n    width: 100%;\n    margin-top: 10px;\n}\n.print-format td, .print-format th {\n    vertical-align: top !important;\n    padding: 4px !important;\n}\n.signature td {\n    text-align: center;\n    font-weight: bold;\n    border-top: 1px solid black;\n    padding-top: 50px !important;\n}\n.ts-amount {\n    font-weight: bold;\n    text-align: right;\n}\n.ts-total-row {\n    font-size: 125%;\n}\n",
 "custom_format": 1,
 "default_print_language": "en-US",
 "disabled": 0,
 "doc_type": "Project",
 "docstatus": 0,
 "doctype": "Print Format",
 "font": "Default",
 "html": "{% set other_work=[] %}\n{% set raw_material_supplied_per_sqft = 0 %}\n{% set raw_material_supplied_per_sqft_without_cs = 0 %}\n{% set xx = get_site_sales_order_item_prices(doc.name) %}\n{% set site_item_details = xx.paver %}\n {% set d = get_retail_cost(doc.name) %}\n{% set site_item_details_compound_wall = xx.compound_wall %}\n<html>\n<head>\n\n<!--<div class=\"ex1\">-->\n<table style=\"width:100%;\">\n    <tr>\n         <td  colspan=\"2\" align=\"center\" style=\"background-color: #D6EEEE; font-size: 125%\"><b>{{ (doc.type or \"\").upper() }} - SITE COMPLETION REPORT </b><br></td>\n    </tr>\n     \n     <tr>\n         <td colspan=\"2\" style=\"border-bottom:1px solid; font-size: 125%\" align=\"center\"><b>{{doc.name}}</b><br></td>\n    </tr>\n \n      </table>\n      <div><br></div>\n      <div>\n          <table  style=\"width:100%\">\n            <tr>\n                <td style=\"width:50%\"><b>DATE: </b>{{ frappe.utils.formatdate(doc.completion_date) }}</td>\n                <td style=\"width:50%\"><b>ORDER SHEET NO: </b> \n                    {% set order_no = [] %}\n                    {% if doc.type==\"Compound Wall\" %}\n                        {% for i in site_item_details_compound_wall %}\n                            {% if (i.sales_order and i.sales_order not in order_no) %}\n                                {% if (order_no|len > 0) %}\n                                    {{\", \"}}\n                                {% endif %}\n                                <nobr>{{i.sales_order}} / {{ frappe.utils.formatdate(frappe.db.get_value(\"Sales Order\", i.sales_order, \"transaction_date\")) }}</nobr>\n                                {% set _=order_no.append(i.sales_order) %}\n                            {% endif %}\n                        {% endfor %}\n                    {% endif %}\n                     {% set order_no = [] %}\n                    {% if doc.type==\"Pavers\" %}\n                        {% for i in site_item_details %}\n                            {% if (i.sales_order and i.sales_order not in order_no) %}\n                                {% if (order_no|len > 0) %}\n                                    {{\", \"}}\n                                {% endif %}\n                               <nobr>{{i.sales_order}} / {{ frappe.utils.formatdate(frappe.db.get_value(\"Sales Order\", i.sales_order, \"transaction_date\")) }}</nobr>\n                                {% set _=order_no.append(i.sales_order) %}\n                            {% endif %}\n                        {% endfor %}\n                    {% endif %}\n                </td>\n           </tr>\n           <tr>\n             <td style=\"width:50%\"><b>RATE:\n                            {% if doc.type==\"Compound Wall\" %}\n                                {% set a=[] %}\n                                \n                                {% for i in site_item_details_compound_wall %}\n                                    {% if i.rate not in a %}\n                                        {% set _=a.append(i.rate or 0) %}\n                                    {% endif %}\n                                {% endfor %}\n                                \n                                {% for i in a %}\n                                    {{\"%.2f\"|format(i) }}\n                                    {% if loop.index != a|length %}\n                                        {{', '}}\n                                    {% endif %}\n                                {% endfor %}\n                                \n                            {% endif %}\n                            \n                            {% if doc.type==\"Pavers\" %}\n                                {% set a=[] %}\n                                \n                                {% for i in site_item_details %}\n                                    {% if i.rate not in a %}\n                                        {% set _=a.append(i.rate or 0) %}\n                                    {% endif %}\n                                {% endfor %}\n                                \n                                {% for i in a %}\n                                    {{\"%.2f\"|format(i) }}\n                                    {% if loop.index != a|length %}\n                                        {{', '}}\n                                    {% endif %}\n                                {% endfor %}\n                            {% endif %}\n                </b></td>\n              \n             <td style=\"width:50%\"><b>SITE SUPERVISOR: {{doc.supervisor_name}} </b></td>\n            \n          </tr>\n  <tr>\n   <td style=\"width:50%\"><b>LAYER NAME: {% set a=[] %}\n    {% for name in doc.job_worker|unique(attribute='employee_name') %}\n        {% if (a|len > 0) %}\n            {{\", \"}}\n        {% endif %}\n        <span style=\"font-size: 120%;\">{{ name.employee_name or \"\"}}</span>\n        {% set _=a.append(name.employee_name) %}\n    {% endfor %}\n</b></td>\n     <td style=\"width:50%\"><b>LAYER RATE: {% if doc.job_worker %}\n        {% set a=[] %}\n            {% for i in doc.job_worker %}\n                {% if (i.rate or 0) not in a %}\n                    {% if (a|len > 0) %} {{\", \"}} {% endif %}\n                    {{ \"%.2f\"%(i.rate or 0) }}\n                    {% set _=a.append(i.rate or 0) %}\n                {% endif %}\n            {% endfor %}\n        {% endif %}\n    </b></td>\n  </tr>\n  </table>\n      </div>\n       <div><br></div>\n       <div>\n          <table  style=\"width:100%\">\n                {% for i in d.item_cost %}\n                    <tr>\n                        <td style=\"width:55%\">\n                            {{i.item}}\n                        </td>\n                        <td>\n                           {{\"%.2f\"|format(i.qty)}}\n                        </td>\n                    </tr>\n                {% endfor%}\n             \n  <tr>\n    <td><b>SUPPLIED SQFT</b></td>\n   <td> {% if doc.delivery_detail %}\n     {% set a=[] %}\n                    {% for i in doc.delivery_detail %} {% set _=a.append((i.delivered_stock_qty or 0)+(i.returned_stock_qty or 0)) %} {% endfor %}\n                    {{\"%.2f\"|format((a|sum) )}} SQFT\n                    {% endif %} </td>\n  </tr> \n  <tr>\n   <td><b>COMPLETED AREA IN SQFT</b></td>\n    <td> {{doc.measurement_sqft}} SQFT </td>\n  </tr>\n\n  {% if doc.type == \"Compound Wall\" %}\n    <tr>\n        \n        <td>\n            <b>EARTH FOUNDATION</b>\n        </td>\n        <td>\n            {{ doc.earth_foundation_sqft or 0.00 }}\n        </td>\n    </tr>\n  {% endif %}\n  \n  <tr>\n    <td><b>MATERIAL SUPPLY IF ANY</b></td>\n    <td>{% if doc.material_supply ==1 %}\n    YES\n    {% endif %}\n    {% if doc.material_supply ==0 %}\n    NO\n    {% endif %}</td>\n  </tr>\n    <tr>\n    <td><b>WORK COMPLETED</b></td>\n    <td>{% if doc.work_completed ==1 %}\n    YES\n    {% endif %}\n    {% if doc.work_completed ==0 %}\n    NO\n    {% endif %}</td>\n  </tr>\n  <tr>\n    <td><b>CUTTING PIECE</b></td>\n    <td>{% if doc.cutting_piece ==1 %}\n    YES\n    {% endif %}\n    {% if doc.cutting_piece ==0 %}\n    NO\n    {% endif %}</td>\n  </tr>\n    {% if doc.type!=\"Compound Wall\" %}\n        <tr>\n        <td><b>DUST SEWING</b></td>\n        <td>{% if doc.dust_swing ==1 %}\n        YES\n        {% endif %}\n        {% if doc.dust_swing ==0 %}\n        NO\n        {% endif %}</td>\n      </tr>\n  {% endif %}\n  {% if doc.type!=\"Compound Wall\" %}\n      <tr>\n        <td><b>DUST FINISHING WITH EARTH RAMMER</b></td>\n        <td>{% if doc.dust_finishing_with_rammer ==1 %}\n        YES\n        {% endif %}\n        {% if doc.dust_finishing_with_rammer ==0 %}\n        NO\n        {% endif %}</td>\n      </tr>\n  {% endif %}\n  {% if doc.type!=\"Compound Wall\" %}\n    <tr>\n    <td><b>DUST SWEEPING</b></td>\n    <td>{% if doc.dust_sweeping ==1 %}\n    YES\n    {% endif %}\n    {% if doc.dust_sweeping ==0 %}\n    NO\n    {% endif %}</td>\n  </tr>\n  {% endif %}\n    <tr>\n    <td><b>ANY FOOD EXP IN SITE</b></td>\n    <td>{% if doc.any_food_exp_in_site ==1 %}\n    {{ doc.food_expense_amt or \"YES\" }}\n    {% endif %}\n    {% if doc.any_food_exp_in_site ==0 %}\n    NO\n    {% endif %}</td>\n  </tr>\n  <tr>\n    <td><b>OTHER LABOUR WORK IF ANY</b></td>\n    <td> \n    {% set other_work=[] %}\n    {% for i in doc.job_worker %} \n        {% if (i.other_work) %}\n            {% set _=other_work.append(i) %}\n        {% endif %}\n    {% endfor %}\n\n                    {% if ((other_work|len)>0) %}\n                    YES\n                   {% else %}\n                NO\n                    {% endif %}</td>\n  </tr>  <tr>\n    <td><b>SITE ADVANCE</b></td>\n    <td> {{doc.total_advance_amount or \"NO\" }}</td>\n  </tr>\n  <tr>\n    <td><b>LAYER PAYMENT IN SQFT</b></td>\n    <td>{{ (doc.total_layed_sqft or 0) | int}}  SQFT</td>\n  </tr>\n    <tr>\n      <td><b>SCRAP RETURN</b></td>\n      <td>{{ doc.returned_scrap_qty }} SQFT</td>\n  </tr>\n  <tr>\n    <td><b style=\"font-size: 120%\">SITE STOCK</b></td>\n    <td>\n        <b style=\"font-size: 120%\">{{ doc.site_stock or 'NIL' }}</b>\n    </td>\n  </tr>\n  </table>\n  \n    {% if doc.material_supply %}\n        <b><h3>Materials Supplied</h3></b>\n        <table style=\"width: 100%\">\n            <tr>\n                <th>\n                    Item\n                </th>\n                 <th>\n                    Qty\n                </th>\n            </tr>\n            {% set site_completion_delivery_detail = site_completion_delivery_uom(doc.name) %}\n            {% set delivered_details = site_completion_delivery_detail['delivery_detail'] %}\n            {% set customer_scope_qty = site_completion_delivery_detail['customer_scope_qty'] %}\n            \n            {% for row in delivered_details %}\n                <tr>\n                    <td>\n                        {{ row }}\n                    </td>\n                    <td>\n                        {% set comma=[] %}\n                        {% for del_det in delivered_details[row] %}\n                            {% if comma|len > 0%}{{\", \"}}{% endif %}{{ del_det.qty }} {{ del_det.uom }}\n                            {% set _= comma.append(1) %}\n                        {% endfor %}\n                        \n                    </td>\n                </tr>\n            {% endfor %}\n        </table>\n    {% endif %}\n    \n    {% if other_work|len > 0 %}\n        <b><h3>Other Work Description</h3></b>\n        <table style=\"width: 100%\">\n            <tr>\n                <th>\n                    Job Worker\n                </th>\n                <th>\n                    Start Date\n                </th>\n                <th>\n                    Description\n                </th>\n                <th>\n                    Sqft/Person\n                </th>\n                <th>\n                    Rate\n                </th>\n                <th>\n                    Amount\n                </th>\n            </tr>\n            {% for row in doc.job_worker %}\n                <tr>\n                    {% if row.other_work %}\n                        <td>\n                            {{ row.employee_name }}\n                        </td>\n                        <td>\n                            {{ frappe.utils.formatdate(row.start_date) }}\n                        </td>\n                        <td>\n                            {{ row.description_for_other_work or \"-\" }}\n                        </td>\n                        <td>\n                            {% if row.amount_calc_by_person %}\n                                {{ row.no_of_person or 0 }} Person\n                            {% else %}\n                                {{ row.sqft_allocated or 0 }} Sqft\n                            {% endif %}\n                        </td>\n                        <td>\n                            {% if row.amount_calc_by_person %}\n                                {{ row.rate_person or 0 }}\n                            {% else %}\n                                {{ row.rate or 0 }}\n                            {% endif %}\n                        </td>\n                        <td>\n                            {{ row.amount or 0 }}\n                        </td>\n                    {% endif %}\n                </tr>\n            {% endfor %}\n        </table>\n    {% endif %}\n    </div>\n    {% if doc.remarks %}\n        <div style=\"width: 100%; font-size: 130%\">\n            <b><h3>Remarks</h3> {{ doc.remarks }}</b>\n        </div>\n    {% endif %}\n    <br><br><br>\n    <table class=\"signature\">\n        <tr>\n            <td  style=\"border-bottom: 0; height:40px;\">\n            </td>\n            <td style=\"border-bottom: 0;\">\n            </td>\n        </tr>\n        <tr>\n            <td style=\"border-top: 0;\">\n                Signature of SUPERVISOR\n            </td>\n            <td style=\"border-top: 0;\">\n                Signature of MANAGING DIRECTOR\n            </td>\n        </tr>\n    </table>\n<!--</div>-->\n<div class=\"page-break\"></div>\n<div>\n    <table style=\"width:100%;\">\n    <tr>\n         <td  colspan=\"2\" align=\"center\" style=\"background-color: #D6EEEE; font-size: 125%\"><b>{{ (doc.type or \"\").upper() }} - SITE COMPLETION REPORT </b><br></td>\n    </tr>\n     \n     <tr>\n         <td colspan=\"2\" style=\"border-bottom:1px solid; font-size: 125%\" align=\"center\"><b>{{doc.name}}</b><br></td>\n    </tr>\n \n      </table>\n      <div><br></div>\n      <div>\n          <table  style=\"width:100%\">\n            <tr>\n                <td style=\"width:50%\"><b>DATE: </b>{{ frappe.utils.formatdate(doc.completion_date) }}</td>\n                <td style=\"width:50%\"><b>ORDER SHEET NO: </b> \n                    {% set order_no = [] %}\n                    {% if doc.type==\"Compound Wall\" %}\n                        {% for i in site_item_details_compound_wall %}\n                            {% if (i.sales_order and i.sales_order not in order_no) %}\n                                {% if (order_no|len > 0) %}\n                                    {{\", \"}}\n                                {% endif %}\n                                <nobr>{{i.sales_order}} / {{ frappe.utils.formatdate(frappe.db.get_value(\"Sales Order\", i.sales_order, \"transaction_date\")) }}</nobr>\n                                {% set _=order_no.append(i.sales_order) %}\n                            {% endif %}\n                        {% endfor %}\n                    {% endif %}\n                     {% set order_no = [] %}\n                    {% if doc.type==\"Pavers\" %}\n                        {% for i in site_item_details %}\n                            {% if (i.sales_order and i.sales_order not in order_no) %}\n                                {% if (order_no|len > 0) %}\n                                    {{\", \"}}\n                                {% endif %}\n                               <nobr>{{i.sales_order}} / {{ frappe.utils.formatdate(frappe.db.get_value(\"Sales Order\", i.sales_order, \"transaction_date\")) }}</nobr>\n                                {% set _=order_no.append(i.sales_order) %}\n                            {% endif %}\n                        {% endfor %}\n                    {% endif %}\n                </td>\n           </tr>\n           <tr>\n                <td style=\"width:50%\"><b>RATE:\n                            {% if doc.type==\"Compound Wall\" %}\n                                {% set a=[] %}\n                                \n                                {% for i in site_item_details_compound_wall %}\n                                    {% if i.rate not in a %}\n                                        {% set _=a.append(i.rate or 0) %}\n                                    {% endif %}\n                                {% endfor %}\n                                \n                                {% for i in a %}\n                                    {{\"%.2f\"|format(i) }}\n                                    {% if loop.index != a|length %}\n                                        {{', '}}\n                                    {% endif %}\n                                {% endfor %}\n                                \n                            {% endif %}\n                            \n                            {% if doc.type==\"Pavers\" %}\n                                {% set a=[] %}\n                                \n                                {% for i in site_item_details %}\n                                    {% if i.rate not in a %}\n                                        {% set _=a.append(i.rate or 0) %}\n                                    {% endif %}\n                                {% endfor %}\n                                \n                                {% for i in a %}\n                                    {{\"%.2f\"|format(i) }}\n                                    {% if loop.index != a|length %}\n                                        {{', '}}\n                                    {% endif %}\n                                {% endfor %}\n                            {% endif %}\n                </b></td>\n              \n             <td style=\"width:50%\"><b>SITE SUPERVISOR: {{doc.supervisor_name}} </b></td>\n            \n          </tr>\n  <tr>\n   <td style=\"width:50%\"><b>LAYER NAME: {% set a=[] %}\n    {% for name in doc.job_worker|unique(attribute='employee_name') %}\n        {% if (a|len > 0) %}\n            {{\", \"}}\n        {% endif %}\n        <span style=\"font-size: 120%;\">{{ name.employee_name or \"\"}}</span>\n        {% set _=a.append(name.employee_name) %}\n    {% endfor %}\n</b></td>\n     <td style=\"width:50%\"><b>LAYER RATE: {% if doc.job_worker %}\n        {% set a=[] %}\n            {% for i in doc.job_worker %}\n                {% if (i.rate or 0) not in a %}\n                    {% if (a|len > 0) %} {{\", \"}} {% endif %}\n                    {{ \"%.2f\"%(i.rate or 0) }}\n                    {% set _=a.append(i.rate or 0) %}\n                {% endif %}\n            {% endfor %}\n        {% endif %}\n    </b></td>\n  </tr>\n     {% set a=[] %}\n                    {% for i in doc.delivery_detail %} {% set _=a.append((i.delivered_stock_qty or 0)+(i.returned_stock_qty or 0)) %} {% endfor %}\n  </table>\n      </div>\n       <div><br></div>\n    <div><br></div>\n       <div>\n           <table  style=\"width:100%;font-size: 150%;\">\n               <tr>\n                   <td><b>Invoiced Amount (Without Tax)</b></td>\n                   <td class=\"ts-amount\">{{ doc.get_formatted(\"total_expense_amount\") }}</td>\n               </tr>\n               <tr>\n                   <td><b>Actual Site Cost</b></td>\n                   <td class=\"ts-amount\">{{ doc.get_formatted(\"actual_site_cost_calculation\") }}</td>\n               </tr>\n               <tr>\n                   <td><b>Difference Amount</b></td>\n                   <td class=\"ts-amount\">{{ doc.get_formatted(\"site_profit_amount\") }}</td>\n               </tr>\n           </table>\n       </div>\n\n       {% set supply_and_return_details = get_site_supply_and_return_trip_details(doc.name) %}\n\n        {% set d = get_retail_cost(doc.name) %}\n        {% set itemqty = [] %}\n        {% set itemamount = [] %}\n       <b><h3>Item</h3></b>\n        <table style=\"width: 100%\">\n            <tr>\n                <th>\n                    Name\n                </th>\n                 <th>\n                    Qty\n                </th>\n                <th>\n                    Rate\n                </th>\n                 <th>\n                    Amount\n                </th>\n\n            </tr>\n            {% for i in d.item_cost %}\n                <tr>\n                    <td>\n                        {{i.item}}\n                    </td>\n                    <td class=\"ts-amount\">\n                       {{\"%.2f\"|format(i.qty)}}\n                       {% set _= itemqty.append(i.qty or 0) %}\n                    </td>\n             \n                    <td class=\"ts-amount\">\n                       {{\"%.2f\"|format(i.rate)}}\n                    </td>\n                    <td class=\"ts-amount\">\n                        {% set _= itemamount.append(i.amount or 0) %}\n                      {{\"%.2f\"|format(i.amount)}}\n                         \n                    </td>\n \n                  \n                </tr>\n                {% endfor %}\n                <tr class='ts-total-row'>\n                    <td>\n                        Total\n                    </td>\n                    <td class=\"ts-amount\"> {{ \"%.2f\"|format(itemqty|sum) }} </td>\n                    <td></td>\n                    <td class=\"ts-amount\"> {{ \"%.2f\"|format(itemamount|sum) }} </td>\n                </tr>\n        </table>\n        \n         <br>\n        <table style=\"width: 100%;\">\n            <tr>\n                <th>Supplied SQFT</th>\n                <th>Measurement SQFT</th>\n                <th>Excess or Shortage</th>\n            </tr>\n            <tr>\n                <td>{{ frappe.format(itemqty|sum, 'Float') }}</td>\n                <td>{{ doc.get_formatted(\"measurement_sqft\") }}</td>\n                <td>{{ doc.get_formatted(\"excess_or_remaining_qty\") }}</td>\n            </tr>\n        </table>\n        <div><br></div>\n        \n        <b><h3>Transport Details</h3></b>\n       {% set delivery_detail = get_delivery_transport_detail(doc.name) %}\n       <table style=\"width:100%\">\n             <tr>\n                <td>Transport</td>\n                <td>Amount</td>\n                <td>Delivery Sqft</td>\n                <td>Per Sqft Cost</td>\n             </tr>\n             <tr>\n                 <td><b>Own Vehicle</b></td>\n                 <td class=\"ts-amount\"><b>{{\"%.2f\"|format(d.own_vehicle)}}</b></td>\n                 <td class=\"ts-amount\">{{ \"%.2f\"%(delivery_detail.get(\"own_vehicle\") or 0) }}</td>\n                 <td class=\"ts-amount\">{{ \"%.2f\"%((d.own_vehicle or 0)/(delivery_detail[\"own_vehicle\"] or 1)) }}</td>\n             </tr>\n             {% set rent_amount = [] %}\n             {% for j in doc.additional_cost %}\n               {% if j.amount !=0%}\n                    {% if \"transport\" in j.description|lower %}\n                        {% set _=rent_amount.append(j.amount) %}\n                    {% endif %}\n                {% endif %}\n            {% endfor %}\n            {% if rent_amount|len %}\n                <tr>\n                    <td><b>Rental Vehicle</b></td>\n                    <td class=\"ts-amount\"><b>{{'%.1f' % rent_amount|sum }}</b></td>\n                    <td class=\"ts-amount\">{{ \"%.2f\"%(delivery_detail.get(\"rental_vehicle\") or 0) }}</td>\n                     <td class=\"ts-amount\">{{ \"%.1f\"%((rent_amount|sum)/(delivery_detail[\"rental_vehicle\"] or 1)) }}</td>\n                </tr>\n            {% endif %}\n            \n        </table>\n        <div><br></div>\n        {% if doc.material_supply %}\n        <b><h3>Materials Supplied</h3></b>\n        <table style=\"width: 100%\">\n            <tr>\n                <th>\n                    Item\n                </th>\n                 <th>\n                    Qty\n                </th>\n                <th>\n                    Rate\n                </th>\n                <th>\n                    Amount\n                </th>\n            </tr>\n            {% for row in delivered_details %}\n                <tr>\n                    <td>\n                        {{ row }}\n                    </td>\n                    <td class=\"ts-amount\">\n                        {% set comma=[] %}\n                        {% for del_det in delivered_details[row] %}\n                            {% if comma|len > 0%}{{\", \"}}{% endif %}{{ del_det.qty }} {{ del_det.uom }}\n                            {% set _= comma.append(1) %}\n                        {% endfor %}\n                        \n                    </td>\n                    <td class=\"ts-amount\">\n                        {% set comma=[] %}\n                        {% for del_det in delivered_details[row] %}\n                            {% if comma|len > 0%}{{\", \"}}{% endif %}{{ del_det.valuation_rate }}/{{ del_det.uom }}\n                            {% set _= comma.append(1) %}\n                        {% endfor %}\n                    </td>\n                    <td class=\"ts-amount\">\n                        {% set total_rate = [] %}\n                        {% for del_det in delivered_details[row] %}\n                            {% set _= total_rate.append((del_det.qty or 0) * (del_det.valuation_rate or 0)) %}\n                        {% endfor %}\n                        {{ \"%.2f\"|format(total_rate|sum) }}\n                         \n                    </td>\n                    \n                </tr>\n   \n            {% endfor %}\n            <tr class='bg_color ts-total-row'>\n                <td>Total</td>\n                <td></td>\n                <td></td>\n                {% set total_raw_material = [] %}\n                {% set total_raw_material_without_cs = [] %}\n                \n                {% for row in delivered_details %}\n                    {% set total_rate = [] %}\n                    {% set item_total_qty = [] %}\n                    {% set item_rate = [] %}\n                    \n                    {% for del_det in delivered_details[row] %}\n                        {% set _= item_rate.append(del_det.valuation_rate or 0) %}\n                        {% set _= total_rate.append((del_det.qty or 0) * (del_det.valuation_rate or 0)) %}\n                        {% set _= item_total_qty.append(del_det.qty or 0) %}\n                    {% endfor %}\n                \n                    {% for i in total_rate %}\n                        {% set _= total_raw_material.append(i|float) %}\n                    {% endfor %}\n                    \n                    {% if (customer_scope_qty.get(row) or 0) > (item_total_qty|sum) %}\n                        {% set _= total_raw_material_without_cs.append(0) %}\n                    {% else %}\n                        {% set _= total_raw_material_without_cs.append( ((item_total_qty|sum) - (customer_scope_qty.get(row) or 0))* ((item_rate|sum)/(item_rate|length)) ) %}\n                    {% endif %}\n                    \n                   \n                     \n                {% endfor %}\n                \n                {% if doc.delivery_detail %}\n                    {% set a=[] %}\n                    {% for i in doc.delivery_detail %} \n                        {% set _=a.append((i.delivered_stock_qty or 0)+(i.returned_stock_qty or 0)) %} \n                    {% endfor %}\n                    \n                {% endif %}\n                    \n                <td class=\"ts-amount\">{{\"%.2f\"|format(total_raw_material|sum)}}</td>\n            </tr>\n        \n            <tr class = \"bg_color\">\n                <td >\n                    Rate Per Supplied Sqft\n                </td>\n                <td>\n                     \n                </td>\n                <td>\n                     \n                </td>\n                <td class=\"ts-amount\">\n                    {% set raw_material_supplied_per_sqft =  total_raw_material|sum/(\"%.2f\"|format((a|sum) or 1)|float) %}\n                    {% set raw_material_supplied_per_sqft_without_cs =  total_raw_material_without_cs|sum/(\"%.2f\"|format((a|sum) or 1)|float) %}\n                     \n                    {{\"%.2f\"|format(raw_material_supplied_per_sqft)}}\n                </td>\n            </tr>\n               \n        </table>\n    {% endif %}\n</div>\n\n      \n       {% if d.unrelated_other_per_sqft %}\n           <div><br></div>\n            <table style=\"width: 100%;\">\n                <tr>\n                    <td></td>\n                    <td>Sqft</td>\n                    <td>Amount</td>\n                    <td>Rate Per Sqft</td>\n                </tr>\n                <tr>\n                    <td>Actual Other Work</td>\n                    <td class=\"ts-amount\">{{ \"%.2f\"%d.unrelated_other_sqft }}</td>\n                    <td class=\"ts-amount\">{{ \"%.2f\"%d.unrelated_other_cost }}</td>\n                    <td class=\"ts-amount\">{{ \"%.2f\"%d.unrelated_other_per_sqft }}</td>\n                </tr>\n            </table>\n        {% endif %}\n<div><br></div>\n\n{% set item_wise_so_rate = get_item_wise_so_rate(doc.name) %}\n{% set item_wise_completion_rate = get_item_wise_completion_rate(doc.name) %}\n\n<b><h3 style=\"margin-top:0\">Actual Site Cost Split-Up</h3></b>\n    {% set loopidx = [] %}\n    {% for actual_item_cd in d.item_cost %}\n        {% if actual_item_cd.qty %}\n            {% set _ = loopidx.append(1) %}\n            <b><h3 style=\"margin-top:10px\">{{ actual_item_cd.item }}</h3></b>\n            <table style=\"width: 100%\" class=\"actual-item-cost-{{loopidx|length}}\">\n                <tr>\n                    <th rowspan=2 style=\"vertical-align: middle !important\">Expense</th>\n                    <th colspan=2>\n                        Full Amount\n                    </th>\n                    <th colspan=2>\n                        Amount Without Customer Scope\n                    </th>\n                </tr>\n                <tr>\n                    <th>\n                        Amount\n                    </th>\n                    <th>\n                        Rate Per Supply Sqft\n                    </th>\n                    <th>\n                        Amount\n                    </th>\n                    <th>\n                        Rate Per Supply Sqft\n                    </th>\n                </tr>\n                <tr>\n                    <td>\n                        Item Cost\n                    </td>\n                    <td class=\"ts-amount\">\n                         {{\"%.2f\"|format(actual_item_cd.amount)}}\n                    </td>\n                    <td class=\"ts-amount\">\n                        {{\"%.2f\"|format(actual_item_cd.rate) }}\n                    </td>\n                    <td class=\"ts-amount\">\n                         {{\"%.2f\"|format(actual_item_cd.amount)}}\n                    </td>\n                    <td class=\"ts-amount\">\n                        {{\"%.2f\"|format(actual_item_cd.rate) }}\n                    </td>\n                    \n                </tr>\n                <tr>\n                    <td>\n                        \n                        Raw Material Cost\n                    </td>\n                    <td class=\"ts-amount\">\n                       {{ \"%.2f\"|format(total_raw_material|sum) }}\n                    </td>\n                    <td class=\"ts-amount\">\n                        {{\"%.2f\"|format(raw_material_supplied_per_sqft)}}\n                    </td>\n                    <td class=\"ts-amount\">\n                        {{ \"%.2f\"|format(total_raw_material_without_cs|sum) }}\n                    </td>\n                    <td class=\"ts-amount\">\n                        {{\"%.2f\"|format(raw_material_supplied_per_sqft_without_cs)}}\n                    </td>\n                </tr>\n               \n                <tr>\n                    <td>\n                       Transport Cost\n                    </td>\n                    <td class=\"ts-amount\">\n                       {{\"%.2f\"|format((d.rental or 0)+(d.own_vehicle or 0)) }}\n                    </td>\n                        {% set ownvehicle_sqft = d.own_vehicle / (delivery_detail.get(\"own_vehicle\") or 1)  %}\n                        {% set rent_sqft = d.rental / (delivery_detail.get(\"rental_vehicle\") or 1) %}\n                    <td class=\"ts-amount\">\n                        {% set rent_and_own_vehicle_cost = ((d.rental or 0)+(d.own_vehicle or 0)) / (( (delivery_detail.get(\"own_vehicle\") or 0) + (delivery_detail.get(\"rental_vehicle\") or 0)  ) or 1) %}\n    \n                       {{\"%.2f\"|format( rent_and_own_vehicle_cost) }}\n                    </td>\n                    \n                    <td class=\"ts-amount\">\n                       {{\"%.2f\"|format((d.rental_without_cs or 0)+(d.own_vehicle_without_cs or 0)) }}\n                    </td>\n                        {% set ownvehicle_sqft_without_cs = d.own_vehicle_without_cs / (delivery_detail.get(\"own_vehicle_without_cs\") or 1)  %}\n                        {% set rent_sqft_without_cs = d.rental_without_cs / (delivery_detail.get(\"rental_vehicle_without_cs\") or 1) %}\n                    <td class=\"ts-amount\">\n                        {% set rent_and_own_vehicle_cost_without_cs = ((d.rental_without_cs or 0)+(d.own_vehicle_without_cs or 0)) / (( (delivery_detail.get(\"own_vehicle_without_cs\") or 0) + (delivery_detail.get(\"rental_vehicle_without_cs\") or 0)  ) or 1) %}\n                        {% if not ( (delivery_detail.get(\"own_vehicle_without_cs\") or 0) + (delivery_detail.get(\"rental_vehicle_without_cs\") or 0) ) %}\n                            {% set rent_and_own_vehicle_cost_without_cs = 0 %}\n                        {% endif %}\n                        \n                        {{\"%.2f\"|format( rent_and_own_vehicle_cost_without_cs) }}\n                    </td>\n                </tr>\n                \n                <tr>\n                    <td>\n                      Job Work Rate\n                    </td>\n                    <td class=\"ts-amount\">\n                      {{\"%.2f\"|format(((d.job_work_rate.get(actual_item_cd.item) or {}).get('amount') or 0))}}\n                         \n                    </td>\n                     {% set job_work_sqft = ((d.job_work_rate.get(actual_item_cd.item) or {}).get('rate') or 0) %}\n                    <td class=\"ts-amount\">\n                      {{\"%.2f\"|format(job_work_sqft)}}\n                         \n                    </td>\n                   <td class=\"ts-amount\">\n                      {{\"%.2f\"|format(((d.job_work_rate_without_cs.get(actual_item_cd.item) or {}).get('amount') or 0))}}\n                         \n                    </td>\n                     {% set job_work_sqft_without_cs = ((d.job_work_rate_without_cs.get(actual_item_cd.item) or {}).get('rate') or 0) %}\n                    <td class=\"ts-amount\">\n                      {{\"%.2f\"|format(job_work_sqft_without_cs)}}\n                         \n                    </td>\n                </tr>\n                <tr>\n                    <td>\n                      Other Work Rate\n                    </td>\n                    <td class=\"ts-amount\">\n                      {{\"%.2f\"|format(d.other_rate) }}\n                    </td>\n                    {% set other_rate_sqft = d.other_rate / (a|sum or 1)  %}\n                    <td class=\"ts-amount\">\n                      {{\"%.2f\"|format(other_rate_sqft)}}\n                    </td>\n                    <td class=\"ts-amount\">\n                      {{\"%.2f\"|format(d.other_rate_without_cs) }}\n                    </td>\n                    {% set other_rate_sqft_without_cs = d.other_rate_without_cs / (a|sum or 1)  %}\n                    <td class=\"ts-amount\">\n                      {{\"%.2f\"|format(other_rate_sqft_without_cs)}}\n                    </td>\n                </tr>\n                <tr>\n                    <td>\n                        Additional Cost\n                    </td>\n                    <td class=\"ts-amount\">\n                       {{\"%.2f\"|format(d.additional_cost)}}\n                    </td>\n                    {% set add_cost_sqft = d.additional_cost / (a|sum or 1)   %}\n                    <td class=\"ts-amount\">\n                       {{\"%.2f\"|format(add_cost_sqft)}}\n                    </td>\n                    <td class=\"ts-amount\">\n                       {{\"%.2f\"|format(d.additional_cost_without_cs)}}\n                    </td>\n                    {% set add_cost_sqft_without_cs = d.additional_cost_without_cs / (a|sum or 1)   %}\n                    <td class=\"ts-amount\">\n                       {{\"%.2f\"|format(add_cost_sqft_without_cs)}}\n                    </td>\n                </tr>\n                \n                <tr class='ts-total-row'>\n                    <td > \n                        Total\n                    </td>\n                    {% set tot_row = d.rental + d.own_vehicle + ((d.job_work_rate.get(actual_item_cd.item) or {}).get('amount') or 0) + d.other_rate + d.additional_cost + actual_item_cd.amount + total_raw_material|sum %}\n                    <td class=\"ts-amount\">\n                        {{\"%.2f\"|format(tot_row)}}\n                    </td>\n                    {% set tot_sqft = rent_and_own_vehicle_cost + ((d.other_rate + d.additional_cost + total_raw_material|sum) / (a|sum or 1))+ (actual_item_cd.rate or 0) + ((d.job_work_rate.get(actual_item_cd.item) or {}).get('rate') or 0) %}\n                    <td class=\"ts-amount\" > \n                        {{\"%.2f\"|format(tot_sqft)}}\n                    </td>\n                    \n                    {% set tot_row_without_cs = d.rental_without_cs + d.own_vehicle_without_cs + ((d.job_work_rate_without_cs.get(actual_item_cd.item) or {}).get('amount') or 0) + d.other_rate_without_cs + d.additional_cost_without_cs + actual_item_cd.amount + total_raw_material_without_cs|sum %}\n                    <td class=\"ts-amount\">\n                        {{\"%.2f\"|format(tot_row_without_cs)}}\n                    </td>\n                    {% set tot_sqft_without_cs = rent_and_own_vehicle_cost_without_cs + ((d.other_rate_without_cs + d.additional_cost_without_cs + total_raw_material_without_cs|sum) / (a|sum or 1))+ (actual_item_cd.rate or 0) + ((d.job_work_rate_without_cs.get(actual_item_cd.item) or {}).get('rate') or 0) %}\n                    <td class=\"ts-amount\" > \n                        {{\"%.2f\"|format(tot_sqft_without_cs)}}\n                    </td>\n                </tr>\n                {% if (item_wise_completion_rate.get(actual_item_cd.item) or 0) %}\n                    <tr>\n                        <td>\n                            Margin (Completion rate: {{ \"%.2f\"%(item_wise_completion_rate.get(actual_item_cd.item) or 0) }})\n                        </td>\n                        <td class=\"ts-amount\">\n                            {{ \"%.2f\"%( (item_wise_completion_rate.get(actual_item_cd.item) or 0) - (tot_sqft or 0) ) }}\n                        </td>\n                        <td class=\"ts-amount\">\n                            {{ \"%.2f\"%( ((item_wise_completion_rate.get(actual_item_cd.item) or 0) - (tot_sqft or 0))/(tot_sqft or 1)*100 ) }}%\n                        </td>\n                        \n                        <td class=\"ts-amount\">\n                            {{ \"%.2f\"%( (item_wise_completion_rate.get(actual_item_cd.item) or 0) - (tot_sqft_without_cs or 0) ) }}\n                        </td>\n                        <td class=\"ts-amount\">\n                            {{ \"%.2f\"%( ((item_wise_completion_rate.get(actual_item_cd.item) or 0) - (tot_sqft_without_cs or 0))/(tot_sqft_without_cs or 1)*100 ) }}%\n                        </td>\n                    </tr>\n                    \n                    {% if (( (item_wise_completion_rate.get(actual_item_cd.item) or 0) - (tot_sqft or 0) ) == ( (item_wise_completion_rate.get(actual_item_cd.item) or 0) - (tot_sqft_without_cs or 0) )) %}\n                        <style>\n                            table.actual-item-cost-{{loopidx|length}} tr td:nth-last-child(-n+2), \n                            table.actual-item-cost-{{loopidx|length}} tr th:nth-last-child(-n+2) {\n                                display: none;\n                            }\n                        </style>\n                    {% endif %}\n\n                {% else %}\n                    <tr>\n                        <td>\n                            Margin (SO rate: {{ \"%.2f\"%(item_wise_so_rate.get(actual_item_cd.item) or 0) }})\n                        </td>\n                        <td class=\"ts-amount\">\n                            {{ \"%.2f\"%( (item_wise_so_rate.get(actual_item_cd.item) or 0) - (tot_sqft or 0) ) }}\n                        </td>\n                        <td class=\"ts-amount\">\n                            {{ \"%.2f\"%( ((item_wise_so_rate.get(actual_item_cd.item) or 0) - (tot_sqft or 0))/(tot_sqft or 1)*100 ) }}%\n                        </td>\n                        \n                        <td class=\"ts-amount\">\n                            {{ \"%.2f\"%( (item_wise_so_rate.get(actual_item_cd.item) or 0) - (tot_sqft_without_cs or 0) ) }}\n                        </td>\n                        <td class=\"ts-amount\">\n                            {{ \"%.2f\"%( ((item_wise_so_rate.get(actual_item_cd.item) or 0) - (tot_sqft_without_cs or 0))/(tot_sqft_without_cs or 1)*100 ) }}%\n                        </td>\n                    </tr>\n                    \n                    {% if (( (item_wise_so_rate.get(actual_item_cd.item) or 0) - (tot_sqft or 0) ) == ( (item_wise_so_rate.get(actual_item_cd.item) or 0) - (tot_sqft_without_cs or 0) )) %}\n                        <style>\n                            table.actual-item-cost-{{loopidx|length}} tr td:nth-last-child(-n+2), \n                            table.actual-item-cost-{{loopidx|length}} tr th:nth-last-child(-n+2) {\n                                display: none;\n                            }\n                        </style>\n                    {% endif %}\n\n                {% endif %}\n            </table>\n        {% endif %}\n    {% endfor %}\n        <!--{{ item_wise_so_rate }}-->\n    {% if supply_and_return_details %}\n        {% if supply_and_return_details['supply'] or supply_and_return_details['return'] %}\n            <b><h3>Supply and Return Details</h3></b>\n            <table style=\"width: 100%;\">\n                <tr>\n                    <th></th>\n                    <th>No of Trips</th>\n                    <th>Qty</th>\n                    <th>Average</th>\n                </tr>\n                {% if supply_and_return_details['supply'] %}\n                    <tr>\n                        <td>Supply Details</td>\n                        <td>{{ supply_and_return_details['supply']['no_of_trips'] or 0 }}</td>\n                        <td>{{ supply_and_return_details['supply']['qty'] or 0 }}</td>\n                        <td>\n                            {% if supply_and_return_details['supply']['no_of_trips'] %}\n                                {{ \"%.2f\"%((supply_and_return_details['supply']['int_qty'] or 0) / (supply_and_return_details['supply']['no_of_trips'] or 1)) }} \n                            {% else %}\n                                0\n                            {% endif %}\n                        </td>\n                    </tr>\n                {% endif %}\n                \n                {% if supply_and_return_details['return'] %}\n                    <tr>\n                        <td>Return Details</td>\n                        <td>{{ supply_and_return_details['return']['no_of_trips'] or 0 }}</td>\n                        <td>{{ supply_and_return_details['return']['qty'] or 0 }}</td>\n                        <td>\n                            {% if supply_and_return_details['return']['no_of_trips'] %}\n                                {{ \"%.2f\"%((supply_and_return_details['return']['int_qty'] or 0) / (supply_and_return_details['return']['no_of_trips'] or 1)) }} \n                            {% else %}\n                                0\n                            {% endif %}\n                        </td>\n                    </tr>\n                {% endif %}\n            </table>\n        {% endif %}\n   {% endif %}\n</body>\n</html>\n",
 "idx": 0,
 "line_breaks": 0,
 "modified": "2023-12-06 11:11:53.874324",
 "modified_by": "Administrator",
 "module": "Ganapathy Pavers",
 "name": "Site Completion",
 "owner": "Administrator",
 "parent": "Project",
 "print_format_builder": 0,
 "print_format_type": "Jinja",
 "raw_printing": 0,
 "show_section_headings": 0,
 "standard": "Yes"
}